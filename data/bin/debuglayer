#!/usr/bin/python3

import os
import subprocess
import sys

from plash.core import Container
from plash.utils import get_subcommand_path

buildscript = get_subcommand_path('build')
raw_container_id = subprocess.check_output([buildscript] + sys.argv[1:] + ['--print-container-id'])
container_id = raw_container_id.decode().strip('\n')
c = Container(container_id)
last_layer = c.get_layer_paths()[-1]

if not os.path.exists(last_layer):
      print('Container must be builded first')
      sys.exit(1)
subprocess.check_call(['tree', os.path.join(last_layer, 'payload')])
