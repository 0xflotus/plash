#!/usr/bin/env python3
#
# usage: plash-alias CONTAINER ALIAS
# Create an alias for a container

import sys
import os
from os import symlink
from os.path import join
from plashlib.utils import handle_help_flag, die_with_usage, nodepath_or_die, catch_and_die, handle_build_args

plash_data = os.environ.get('PLASH_DATA', '/var/lib/plash')

handle_help_flag()
handle_build_args()

try:
    container, alias = sys.argv[1:]
except (IndexError, ValueError):
    die_with_usage()
nodepath = nodepath_or_die(container)
with catch_and_die([OSError]):
    try:
        symlink(nodepath, join(plash_data, 'index', alias))
    except FileExistsError:
        # FIXME: different behaviour, check if this is the right symlink?
        pass
