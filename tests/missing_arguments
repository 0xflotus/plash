#/bin/bash
set -xu

array=(
plash-add-layer
plash-alias
# plash-build
plash-build-shell
plash-export-img
plash-export-squashfs
plash-export-tar
plash-import-cloud
plash-import-tar
plash-import-url
plash-mount
plash-nodepath
plash-run
plash-runc
plash-runp
plash-use
plash-with-mount
)
for prog in "${array[@]}"
do
  $prog 2>/dev/null >/dev/null
  exit=$?
  [ $exit -eq 2 ] || {
    echo "Unexpected exit status when calling '$prog' with no arguments (expected exit status 2, got $exit)"
    exit 1
  }

  out=$($prog --help)
  substr='usage: '
  echo $out
  [ "${out:0:${#substr}}" == "$substr" ] || {
    echo "Calling \"$prog --help\" seems not to print usage"
    exit 1
  }
  # out=$($prog 2>&1) || true
  # echo "$out" | grep '/bin/plash' && {
  #   echo "No arguments seems to crash $prog"
  #   exit 1
  # }
done
