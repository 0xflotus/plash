#/bin/bash
set -xu

array=(
plash
plash.add-layer
plash.do
plash.export-tar
plash.import-linuxcontainers
plash.import-tar
plash.import-url
# plash.init
plash.mount
plash.nodepath
# plash.purge
# plash.rm
plash.run
plash.runfile
plash.runp
)
for prog in "${array[@]}"
do
  $prog 2>/dev/null >/dev/null
  exit=$?
  [ $exit -eq 2 ] || {
    echo "Unexpected exit status when calling '$prog' with no arguments (expected exit status 2, got $exit)"
    exit 1
  }

  out=$($prog --help)
  substr='USAGE: '
  echo $out
  [ "${out:0:${#substr}}" == "$substr" ] || {
    echo "Calling \"$prog --help\" seems not to print usage"
    exit 1
  }
  # out=$($prog 2>&1) || true
  # echo "$out" | grep '/bin/plash' && {
  #   echo "No arguments seems to crash $prog"
  #   exit 1
  # }
done
