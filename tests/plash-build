set -xeu
# vim: set filetype=sh:
busybox=$(plash-build -i busybox --bust-cache)

echo 'TEST: build a layer and check it changes'
newcont=$(plash-build -i $busybox -x 'touch /hellow')
plash-run $newcont stat /hellow


echo 'TEST: working directory is is /'
plash-build -i $busybox --bust-cache -x 'test $(pwd) == /'

echo 'TEST: test that a build error returns a bad exit code'
set +e
plash-build -i $busybox -x 'exit 42'
test 1 -eq $? || exit 1
set -e

echo 'TEST: base container specified as first argument and via the os hint comment'
